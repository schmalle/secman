package com.secman.repository

import com.secman.domain.VulnerabilityException
import com.secman.domain.VulnerabilityException.ExceptionType
import io.micronaut.data.annotation.Repository
import io.micronaut.data.jpa.repository.JpaRepository
import java.time.LocalDateTime

/**
 * Repository for VulnerabilityException entity operations
 *
 * Related to: Feature 004-i-want-to (VULN Role & Vulnerability Management UI)
 */
@Repository
interface VulnerabilityExceptionRepository : JpaRepository<VulnerabilityException, Long> {

    /**
     * Find all active exceptions (not expired)
     * Used for checking if vulnerabilities are excepted
     *
     * @param date The current date/time to compare against expiration
     * @return List of active exceptions
     */
    fun findByExpirationDateIsNullOrExpirationDateGreaterThan(date: LocalDateTime): List<VulnerabilityException>

    /**
     * Find exceptions by type (IP or PRODUCT)
     *
     * @param type The exception type to filter by
     * @return List of exceptions matching the type
     */
    fun findByExceptionType(type: ExceptionType): List<VulnerabilityException>

    /**
     * Find exceptions created by a specific user
     *
     * @param username The username who created the exceptions
     * @return List of exceptions created by the user
     */
    fun findByCreatedBy(username: String): List<VulnerabilityException>
}
