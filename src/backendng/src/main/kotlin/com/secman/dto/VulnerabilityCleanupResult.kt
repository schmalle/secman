package com.secman.dto

import io.micronaut.serde.annotation.Serdeable

/**
 * Response DTO for vulnerability duplicate cleanup operation
 *
 * Purpose: Response for POST /api/vulnerabilities/cleanup-duplicates endpoint
 * Provides statistics about duplicate vulnerabilities that were removed
 *
 * A duplicate vulnerability is defined as:
 * - Same asset ID
 * - Same vulnerability ID (CVE)
 * - Same scan timestamp
 *
 * The cleanup process keeps the oldest record (lowest ID) and removes newer duplicates
 */
@Serdeable
data class VulnerabilityCleanupResult(
    val totalScanned: Int,
    val duplicatesFound: Int,
    val duplicatesRemoved: Int,
    val uniqueVulnerabilitiesRemaining: Int,
    val message: String
) {
    companion object {
        fun success(
            totalScanned: Int,
            duplicatesFound: Int,
            duplicatesRemoved: Int,
            uniqueRemaining: Int
        ): VulnerabilityCleanupResult {
            return VulnerabilityCleanupResult(
                totalScanned = totalScanned,
                duplicatesFound = duplicatesFound,
                duplicatesRemoved = duplicatesRemoved,
                uniqueVulnerabilitiesRemaining = uniqueRemaining,
                message = "Successfully removed $duplicatesRemoved duplicate vulnerabilities. " +
                        "$uniqueRemaining unique vulnerabilities remaining."
            )
        }

        fun noCleanupNeeded(totalScanned: Int): VulnerabilityCleanupResult {
            return VulnerabilityCleanupResult(
                totalScanned = totalScanned,
                duplicatesFound = 0,
                duplicatesRemoved = 0,
                uniqueVulnerabilitiesRemaining = totalScanned,
                message = "No duplicate vulnerabilities found. Database is clean."
            )
        }
    }
}
