package com.secman.dto

import io.micronaut.serde.annotation.Serdeable
import jakarta.validation.Valid
import jakarta.validation.constraints.NotBlank
import jakarta.validation.constraints.NotNull
import jakarta.validation.constraints.Size

/**
 * Request DTO for /api/crowdstrike/vulnerabilities/save endpoint
 *
 * Feature: 032-servers-query-import
 * Spec reference: FR-015a
 *
 * Contains server metadata and its associated vulnerabilities for batch import.
 * Supports transaction-per-server logic with atomic delete+insert operations.
 *
 * @property hostname Server hostname (used as Asset.name, unique identifier)
 * @property groups Comma-separated group names from CrowdStrike
 * @property cloudAccountId AWS/cloud account ID
 * @property cloudInstanceId Cloud instance identifier
 * @property adDomain Active Directory domain
 * @property osVersion Operating system version
 * @property ip IP address
 * @property vulnerabilities List of vulnerabilities for this server
 */
@Serdeable
data class CrowdStrikeVulnerabilityBatchDto(
    @field:NotBlank
    @field:Size(min = 1, max = 255)
    val hostname: String,

    @field:Size(max = 512)
    val groups: String?,

    @field:Size(max = 255)
    val cloudAccountId: String?,

    @field:Size(max = 255)
    val cloudInstanceId: String?,

    @field:Size(max = 255)
    val adDomain: String?,

    @field:Size(max = 255)
    val osVersion: String?,

    @field:Size(max = 255)
    val ip: String?,

    @field:NotNull
    @field:Valid
    val vulnerabilities: List<VulnerabilityDto>
)
