package com.secman.dto

import java.time.LocalDateTime

/**
 * DTO for vulnerability export to Excel format
 * Feature: Vulnerability Export Performance Optimization
 *
 * Purpose: Flattened representation of Vulnerability with exception status for Excel export
 * Used by VulnerabilityExportService to convert vulnerability data to Excel-friendly format
 *
 * Columns exported:
 * - Asset Name, IP, CVE ID, Severity, Product, Days Open
 * - Scan Date, Overdue Status, Has Exception, Exception Reason
 */
data class VulnerabilityExportDto(
    val assetName: String,
    val assetIp: String?,
    val cveId: String?,
    val severity: String?,
    val product: String?,
    val daysOpen: String?,
    val scanDate: LocalDateTime,
    val overdueStatus: String,
    val hasException: Boolean,
    val exceptionReason: String?
) {
    companion object {
        /**
         * Factory method to create VulnerabilityExportDto from VulnerabilityWithExceptionDto
         * @param vuln VulnerabilityWithExceptionDto to convert
         * @return VulnerabilityExportDto for Excel export
         */
        fun fromVulnerabilityWithException(vuln: VulnerabilityWithExceptionDto): VulnerabilityExportDto {
            return VulnerabilityExportDto(
                assetName = vuln.assetName,
                assetIp = vuln.assetIp,
                cveId = vuln.vulnerabilityId,
                severity = vuln.cvssSeverity,
                product = vuln.vulnerableProductVersions,
                daysOpen = vuln.daysOpen,
                scanDate = vuln.scanTimestamp,
                overdueStatus = vuln.overdueStatus.name,
                hasException = vuln.hasException,
                exceptionReason = vuln.exceptionReason
            )
        }
    }
}
