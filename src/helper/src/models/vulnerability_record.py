"""T025: VulnerabilityRecord composite model."""
from dataclasses import dataclass
from typing import Optional

from src.models.device import Device
from src.models.vulnerability import Vulnerability


@dataclass
class VulnerabilityRecord:
    """Composite entity combining Vulnerability + Device for export operations."""

    vulnerability: Vulnerability
    device: Device

    def to_row(self) -> list[str]:
        """Convert to export row format matching column order."""
        return [
            self.device.hostname,
            self.device.local_ip,
            ", ".join(self.device.host_groups),
            self.device.cloud_account_id or "",
            self.device.cloud_instance_id or "",
            self.device.os_version,
            self.device.ad_domain or "",
            self.vulnerability.cve_id,
            self.vulnerability.severity.value,
            ", ".join(self.vulnerability.product_versions),
            f"{self.vulnerability.days_open} days",
        ]
