"""T020: Vulnerability data model."""
from dataclasses import dataclass
from datetime import datetime
from typing import Optional

from src.models.enums import Severity


@dataclass
class Vulnerability:
    """Represents a security vulnerability detected on a device."""

    cve_id: str
    severity: Severity
    product_versions: list[str]
    days_open: int
    detected_date: datetime
    cvss_score: Optional[float] = None
    description: Optional[str] = None

    def __post_init__(self) -> None:
        """Validate vulnerability data."""
        # Validate CVE ID pattern
        if not self.cve_id.startswith("CVE-"):
            raise ValueError(f"Invalid CVE ID: {self.cve_id}")

        # Validate days_open
        if self.days_open < 0:
            raise ValueError(f"days_open must be >= 0, got {self.days_open}")

        # Validate CVSS score
        if self.cvss_score is not None and not (0.0 <= self.cvss_score <= 10.0):
            raise ValueError(f"CVSS score must be 0.0-10.0, got {self.cvss_score}")
