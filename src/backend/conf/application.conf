# This is the main configuration file for the application.
# https://www.playframework.com/documentation/latest/ConfigFile

# Default database configuration using MariaDB
db {
  default {
    driver = "org.mariadb.jdbc.Driver"
    url = "jdbc:mariadb://localhost:3306/secman"
    username = "secman"
    password = "CHANGEME"
    jndiName = DefaultDS
    
    # HikariCP connection pool configuration
    hikaricp {
      minimumIdle = 2
      maximumPoolSize = 10
      connectionTimeout = 30000
      idleTimeout = 600000
      maxLifetime = 1800000
      leakDetectionThreshold = 60000
    }
  }
}

# JPA configuration
jpa.default = defaultPersistenceUnit

# Play configuration
play.evolutions.enabled=true
play.evolutions.db.default.autoApply=true
play.evolutions.db.default.autoApplyDowns=true // Optional, but good for development


play.modules {
  enabled += "play.api.db.DBModule"
  enabled += "play.api.db.HikariCPModule"
  enabled += "play.db.jpa.JPAModule"
}

db {
  default {
    migration.auto = true
    jndiName = DefaultDS
  }
}

play.http.secret.key = "changeme"
play.i18n.langs = ["en"]

# Explicitly define enabled filters to ensure only CORSFilter is active
play.filters.enabled = ["play.filters.cors.CORSFilter"]

# CORS Filter configuration
play.filters.cors {
  pathPrefixes = ["/api/"]
  allowedOrigins = ["http://localhost:4321", "http://localhost:4322", "http://127.0.0.1:4321", "http://127.0.0.1:4322"]
  allowedHttpMethods = ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  allowedHttpHeaders = ["Accept", "Content-Type", "Origin", "X-Requested-With"]
  exposedHeaders = ["Access-Control-Allow-Origin"]
  supportsCredentials = true
  preflightMaxAge = 3 days
}

# Ensure CSRF Filter is NOT enabled and its configuration is commented out
# play.filters.enabled += "play.filters.csrf.CSRFFilter"
# play.filters.csrf {
#   header.name = "Csrf-Token"
#   cookie.name = "PLAY_CSRF_TOKEN"
#   cookie.secure = false # Set to true in production if using HTTPS
#   body.bufferSize = 102400
#   token.sign = true
#   bypass {
#     # Example: Bypass CSRF check for all POST requests to /api/auth/login
#     # "POST /api/auth/login" = ".*"
#     # "POST /api/import/.*" = ".*"
#   }
# }
