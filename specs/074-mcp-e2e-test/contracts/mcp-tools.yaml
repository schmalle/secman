# MCP Tool Contracts: Workgroup Management Tools
# Feature: 074-mcp-e2e-test
# Date: 2026-02-04
#
# These contracts define the input schemas and expected responses for new MCP tools.
# MCP tools use JSON-RPC style invocation, not REST endpoints.

tools:
  - name: create_workgroup
    operation: WRITE
    description: "Create a new workgroup (ADMIN role required)"
    authorization:
      permission: WORKGROUPS_WRITE
      requiresDelegation: true
      requiredRole: ADMIN
    inputSchema:
      type: object
      properties:
        name:
          type: string
          description: "Unique name for the workgroup"
          maxLength: 255
        description:
          type: string
          description: "Optional description of the workgroup"
          maxLength: 1000
      required:
        - name
    successResponse:
      content:
        id: number
        name: string
        description: string | null
        message: string
      example:
        id: 42
        name: "E2E-Test-Workgroup"
        description: "Created for E2E testing"
        message: "Workgroup created successfully"
    errorResponses:
      - code: DELEGATION_REQUIRED
        message: "User delegation required for this operation"
      - code: ADMIN_REQUIRED
        message: "ADMIN role required to create workgroups"
      - code: VALIDATION_ERROR
        message: "Workgroup name is required"
      - code: DUPLICATE_ERROR
        message: "Workgroup with this name already exists"

  - name: delete_workgroup
    operation: DELETE
    description: "Delete a workgroup by ID (ADMIN role required)"
    authorization:
      permission: WORKGROUPS_WRITE
      requiresDelegation: true
      requiredRole: ADMIN
    inputSchema:
      type: object
      properties:
        workgroupId:
          type: integer
          description: "ID of the workgroup to delete"
      required:
        - workgroupId
    successResponse:
      content:
        id: number
        message: string
      example:
        id: 42
        message: "Workgroup deleted successfully"
    errorResponses:
      - code: DELEGATION_REQUIRED
        message: "User delegation required for this operation"
      - code: ADMIN_REQUIRED
        message: "ADMIN role required to delete workgroups"
      - code: NOT_FOUND
        message: "Workgroup not found"
      - code: VALIDATION_ERROR
        message: "Workgroup ID is required"

  - name: assign_assets_to_workgroup
    operation: WRITE
    description: "Assign one or more assets to a workgroup (ADMIN role required)"
    authorization:
      permission: WORKGROUPS_WRITE
      requiresDelegation: true
      requiredRole: ADMIN
    inputSchema:
      type: object
      properties:
        workgroupId:
          type: integer
          description: "ID of the target workgroup"
        assetIds:
          type: array
          items:
            type: integer
          description: "List of asset IDs to assign"
          minItems: 1
      required:
        - workgroupId
        - assetIds
    successResponse:
      content:
        workgroupId: number
        assignedCount: number
        message: string
      example:
        workgroupId: 42
        assignedCount: 3
        message: "3 assets assigned to workgroup"
    errorResponses:
      - code: DELEGATION_REQUIRED
        message: "User delegation required for this operation"
      - code: ADMIN_REQUIRED
        message: "ADMIN role required to assign assets"
      - code: NOT_FOUND
        message: "Workgroup not found"
      - code: VALIDATION_ERROR
        message: "Asset IDs list is required and cannot be empty"
      - code: PARTIAL_ERROR
        message: "Some assets could not be assigned"

  - name: assign_users_to_workgroup
    operation: WRITE
    description: "Assign one or more users to a workgroup (ADMIN role required)"
    authorization:
      permission: WORKGROUPS_WRITE
      requiresDelegation: true
      requiredRole: ADMIN
    inputSchema:
      type: object
      properties:
        workgroupId:
          type: integer
          description: "ID of the target workgroup"
        userIds:
          type: array
          items:
            type: integer
          description: "List of user IDs to assign"
          minItems: 1
      required:
        - workgroupId
        - userIds
    successResponse:
      content:
        workgroupId: number
        assignedCount: number
        message: string
      example:
        workgroupId: 42
        assignedCount: 2
        message: "2 users assigned to workgroup"
    errorResponses:
      - code: DELEGATION_REQUIRED
        message: "User delegation required for this operation"
      - code: ADMIN_REQUIRED
        message: "ADMIN role required to assign users"
      - code: NOT_FOUND
        message: "Workgroup not found"
      - code: VALIDATION_ERROR
        message: "User IDs list is required and cannot be empty"
      - code: PARTIAL_ERROR
        message: "Some users could not be assigned"

  - name: delete_asset
    operation: DELETE
    description: "Delete a specific asset by ID with cascade (ADMIN role required)"
    authorization:
      permission: ASSETS_READ  # Uses existing permission with admin check
      requiresDelegation: true
      requiredRole: ADMIN
    inputSchema:
      type: object
      properties:
        assetId:
          type: integer
          description: "ID of the asset to delete"
      required:
        - assetId
    successResponse:
      content:
        id: number
        name: string
        message: string
      example:
        id: 123
        name: "test-server-01"
        message: "Asset deleted successfully"
    errorResponses:
      - code: DELEGATION_REQUIRED
        message: "User delegation required for this operation"
      - code: ADMIN_REQUIRED
        message: "ADMIN role required to delete assets"
      - code: NOT_FOUND
        message: "Asset not found"
      - code: VALIDATION_ERROR
        message: "Asset ID is required"
      - code: DELETE_FAILED
        message: "Failed to delete asset due to cascade constraints"

# Permission Extension
permissions:
  - name: WORKGROUPS_WRITE
    description: "Manage workgroups via MCP (create, delete, assign users/assets)"
    tools:
      - create_workgroup
      - delete_workgroup
      - assign_assets_to_workgroup
      - assign_users_to_workgroup
