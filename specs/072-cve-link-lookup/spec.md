# Feature Specification: Clickable CVE Links with Description Lookup

**Feature Branch**: `072-cve-link-lookup`
**Created**: 2026-01-30
**Status**: Draft
**Input**: User description: "in secman users can see CVE numbers, please ensure, that whereever a CVE number is shown the user can click on it and get a short description of the CVE. Use for this a reliable external datasource."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Click CVE to See Description (Priority: P1)

A security analyst reviewing the vulnerability list wants to quickly understand what a CVE means without leaving secman. They hover over a CVE number (e.g., CVE-2024-1234) and a popover appears showing a short description of the vulnerability, its CVSS severity score, and a link to the full details on the National Vulnerability Database (NVD).

**Why this priority**: This is the core feature. Without the description popover, the CVE numbers are opaque identifiers that force users to manually search external databases.

**Independent Test**: Can be tested by hovering over any CVE ID in the Current Vulnerabilities table and verifying a popover with a description appears.

**Acceptance Scenarios**:

1. **Given** a user is viewing the Current Vulnerabilities table, **When** they hover over a CVE ID for more than 300ms, **Then** a popover appears showing: the CVE ID as header, a short English description (max 300 characters), and the CVSS score with severity badge.
2. **Given** a user sees a CVE popover, **When** they click the CVE link, **Then** a new browser tab opens with the NVD detail page for that CVE.
3. **Given** the external data source is unavailable, **When** a user hovers over a CVE ID, **Then** the popover shows a fallback message ("Unable to load CVE details. Click to view on NVD.") and clicking still opens the NVD page.

---

### User Story 2 - Consistent CVE Links Across All Views (Priority: P2)

A user navigating between different secman views (vulnerability table, CrowdStrike lookup, asset details, exception requests, statistics) expects CVE numbers to behave the same everywhere -- always clickable, always showing the popover on hover.

**Why this priority**: Consistency builds trust and reduces cognitive load. Users should not have to learn different interaction patterns depending on which page they are on.

**Independent Test**: Navigate to each view that displays CVE IDs and verify the same clickable link + popover behavior appears.

**Acceptance Scenarios**:

1. **Given** any page in secman that displays a CVE ID, **When** a user hovers over it, **Then** the same popover interaction is available as in the main vulnerability table.
2. **Given** a CVE ID appears in the CrowdStrike Vulnerability Lookup results, **When** the user hovers over it, **Then** a description popover appears.
3. **Given** a CVE ID appears in the Exception Approval Dashboard, **When** the user hovers over it, **Then** a description popover appears.

---

### User Story 3 - Fast Repeat Lookups (Priority: P3)

A security analyst scrolling through a large vulnerability table encounters the same CVE ID multiple times (across different assets). After the first lookup, subsequent hovers over the same CVE should display the popover instantly without any loading delay.

**Why this priority**: Performance directly impacts usability. A table with 500 rows might reference only 50 distinct CVEs -- caching prevents the system from making redundant requests.

**Independent Test**: Hover over the same CVE ID twice in the same session and verify the second popover appears instantly without a loading spinner.

**Acceptance Scenarios**:

1. **Given** a user has already viewed the popover for CVE-2024-1234, **When** they hover over the same CVE ID again (on the same or different row), **Then** the popover appears instantly without showing a loading indicator.
2. **Given** two users look up the same CVE within 24 hours, **When** the second user hovers over it, **Then** the server returns the cached description without contacting the external data source.

---

### Edge Cases

- What happens when the CVE ID field is null or empty? The display shows a dash (`-`) with no link or hover behavior.
- What happens when the CVE ID does not follow the standard format (e.g., a custom vulnerability ID like "CUSTOM-001")? The system displays it as plain text without a link or popover, since external databases only index standard CVE IDs.
- What happens when the user's network is slow? The popover shows a loading spinner until data arrives (with a 5-second timeout), then falls back to the unavailable message.
- What happens when the external data source is rate-limited? Cached descriptions continue to work. New lookups that fail are handled gracefully with the fallback message.
- What happens when the user moves the mouse away before the popover loads? The popover request is effectively cancelled (the popover is hidden), preventing UI flicker.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: System MUST display all CVE IDs as clickable links that open the NVD detail page in a new browser tab.
- **FR-002**: System MUST show a popover with the CVE description when the user hovers over a CVE link for more than 300 milliseconds.
- **FR-003**: The popover MUST display: the CVE ID, a short English description (truncated to 300 characters if longer), and the CVSS score with severity level when available.
- **FR-004**: System MUST use a single reusable component for CVE display that is applied consistently across all views where CVE IDs appear (vulnerability tables, CrowdStrike lookup, asset details, exception workflows, statistics).
- **FR-005**: System MUST fetch CVE descriptions from the NIST National Vulnerability Database (NVD) API as the external data source.
- **FR-006**: System MUST cache CVE descriptions for at least 24 hours to reduce external API load and improve response times.
- **FR-007**: System MUST degrade gracefully when the external data source is unavailable -- the CVE link remains clickable and the popover shows a fallback message.
- **FR-008**: System MUST display null or empty CVE IDs as a plain dash (`-`) with no link or popover behavior.
- **FR-009**: System MUST display non-standard vulnerability IDs (not matching CVE-YYYY-NNNNN format) as plain text without link or popover behavior.
- **FR-010**: System MUST deduplicate concurrent requests for the same CVE ID so that multiple identical lookups result in only one external API call.
- **FR-011**: System MUST show a loading indicator in the popover while the description is being fetched.
- **FR-012**: System MUST cancel the popover display if the user moves the mouse away before the 300ms hover threshold is reached.

### Key Entities

- **CVE Description**: A cached representation of external CVE data. Key attributes: CVE ID, English description, CVSS severity level, CVSS numeric score, publication date. Sourced from NVD API. Cached with a 24-hour time-to-live.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Every CVE ID displayed in the application is a clickable link that opens the NVD detail page.
- **SC-002**: Users see a CVE description popover within 2 seconds of hovering (first lookup) and instantly for cached lookups.
- **SC-003**: The feature works identically across all 7+ views that display CVE IDs.
- **SC-004**: When the external data source is unavailable, the system continues to function with no errors visible to the user -- CVE links remain clickable and a clear fallback message is shown.
- **SC-005**: Repeated lookups for the same CVE within a user session do not trigger additional network requests.

## Assumptions

- The NIST NVD API v2.0 (https://services.nvd.nist.gov/rest/json/cves/2.0/) is the chosen external data source. It is free, authoritative, and publicly accessible.
- The public rate limit of 5 requests per 30 seconds is sufficient for normal usage when combined with caching. An optional API key can increase this to 50 requests per 30 seconds for production deployments.
- CVE descriptions in English are sufficient (no internationalization needed for CVE data).
- Only standard CVE IDs (format: CVE-YYYY-NNNNN+) are looked up. Custom or non-standard vulnerability identifiers are displayed as plain text.
- The 300ms hover delay provides a good balance between responsiveness and avoiding unnecessary lookups from accidental mouse passes.
